//>>built
define("esri/layers/WFSLayer","dojo/_base/declare dojo/_base/kernel dojo/_base/lang dojo/_base/connect dojo/has dojo/on ../request ../kernel ../graphic ../Color ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../SpatialReference ../geometry/webMercatorUtils ../geometry/Extent ../geometry/Point ../geometry/Multipoint ../geometry/Polyline ../geometry/Polygon ./GraphicsLayer".split(" "),function(s,H,n,A,B,I,v,C,r,p,w,q,t,u,x,D,y,E,F,z,G){s=s([G],{declaredClass:"esri.layers.WFSLayer",
constructor:function(a){this.id="WFSLayer";this.fullExtent=null;this.fields=[];this.geometryType="esriGeometryComplex";this.visibleAtMapScale=this.visible=!0;this.renderer=null;this._graphicArray=[];this._gmlNS="http://www.opengis.net/gml";this._layerEventHandlers=[];this._getCapabilitiesCallback=null;this._options={};n.mixin(this._options,a);this._url="";this._version="1.1.0";this._nsLayerName="";this._wkid=3857;this._mode="snapshot";this._inverseResponse=this._inverseFilter=!1;this._maxFeatures=
100;this._nsGeometryFieldName=this._getFeatureUrl=this._getFeatureRequest="";this._showDetails=!1;this._parseGml=n.hitch(this,this._parseGml);this._getCapabilities=n.hitch(this,this._getCapabilities);this._getCapabilitiesResponse=n.hitch(this,this._getCapabilitiesResponse);this._messageHandler=n.hitch(this,this._messageHandler);this._pointSymbol=new w(w.STYLE_CIRCLE,6,new q(q.STYLE_SOLID,new p([0,255,0]),1),new p([255,0,0]));this._lineSymbol=new q(q.STYLE_SOLID,new p([0,255,0]),3);this._polygonSymbol=
new t(t.STYLE_SOLID,new q(q.STYLE_SOLID,new p([255,0,0]),2),new p([255,255,0,0.25]));this.setWFSParameters(a);""!==this._getFeatureUrl&&""!==this._getFeatureRequest?this.getFeature():(this.mode="snapshot",this.getCapabilities())},getCapabilities:function(a){this._getCapabilitiesCallback=a;a=n.trim(this._url);if(""!==a){this._messageHandler("connect to wfs server...");var d=-1===a.indexOf("?")?"?":"\x26";v({url:a+d+"service\x3dWFS\x26request\x3dGetCapabilities\x26version\x3d"+this._version,handleAs:"text",
headers:{"Content-Type":"text/plain"},timeout:1E4},{usePost:!1}).then(this._getCapabilitiesResponse,this._messageHandler)}},buildRequest:function(){var a=this._nsLayerName.indexOf("|"),d=this._nsLayerName.substring(0,a),e=this._nsLayerName.substring(a+1),a=this._nsGeometryFieldName.indexOf("|"),b=this._nsGeometryFieldName.substring(0,a),a=this._nsGeometryFieldName.substring(a+1),c;c="\x3c?xml version\x3d'1.0' encoding\x3d'utf-8'?\x3e\n\x3cGetFeature \n";c+=" xmlns:xsi\x3d'http://www.w3.org/2001/XMLSchema-instance'\n";
c+=" xmlns:gml\x3d'http://www.opengis.net/gml'\n";c+=" xmlns:ogc\x3d'http://www.opengis.net/ogc'\n";c+=" xmlns:wfs\x3d'http://www.opengis.net/wfs'\n";c="2.0.0"===this._version?c+" xmlns\x3d'http://www.opengis.net/wfs/2.0'\n":c+" xmlns\x3d'http://www.opengis.net/wfs'\n";c+=" xmlns:ns1\x3d'"+d+"'\n";"ondemand"===this._mode.toLowerCase()&&(c+=" xmlns:ns2\x3d'"+b+"'\n");c="2.0.0"===this._version?c+(" version\x3d'"+this._version+"' service\x3d'WFS' count\x3d'"+this._maxFeatures+"'\x3e\n"):c+(" version\x3d'"+
this._version+"' service\x3d'WFS' maxFeatures\x3d'"+this._maxFeatures+"'\x3e\n");c="2.0.0"===this._version?c+(" \x3cQuery typeNames\x3d'ns1:"+e+"' srsName\x3d'EPSG:"+this._wkid+"'\x3e\n"):c+(" \x3cwfs:Query typeName\x3d'ns1:"+e+"' srsName\x3d'EPSG:"+this._wkid+"'\x3e\n");"ondemand"===this._mode.toLowerCase()&&(c+="  \x3cogc:Filter xmlns:ogc\x3d'http://www.opengis.net/ogc'\x3e\n",c+="   \x3cogc:BBOX\x3e\n",c+="    \x3cogc:PropertyName\x3ens2:"+a+"\x3c/ogc:PropertyName\x3e\n",c+="    \x3cgml:Box srsName\x3d'EPSG:"+
this._wkid+"'\x3e\n",c=this._inverseFilter?c+"      \x3cgml:coordinates\x3e{ymin},{xmin} {ymax},{xmax}\x3c/gml:coordinates\x3e\n":c+"      \x3cgml:coordinates\x3e{xmin},{ymin} {xmax},{ymax}\x3c/gml:coordinates\x3e\n",c+="    \x3c/gml:Box\x3e\n",c+="   \x3c/ogc:BBOX\x3e\n",c+="  \x3c/ogc:Filter\x3e\n");c="2.0.0"===this._version?c+" \x3c/Query\x3e\n":c+" \x3c/wfs:Query\x3e\n";return this._getFeatureRequest=c+="\x3c/GetFeature\x3e\n"},getFeature:function(){if(""!==this._getFeatureUrl&&""!==this._getFeatureRequest&&
this._map&&null!==this._map.spatialReference.wkid){var a=this._getFeatureRequest;if("ondemand"===this._mode.toLowerCase()){var a=this._map.extent.xmin,d=this._map.extent.ymin,e=this._map.extent.xmax,b=this._map.extent.ymax,c={},f=this._map.spatialReference,g=new u(this._wkid);this._projectFromSRToSR(f,g,a,d,c)&&(a=c.x,d=c.y);this._projectFromSRToSR(f,g,e,b,c)&&(e=c.x,b=c.y);a=this._getFeatureRequest.replace(/{xmin}/,a).replace(/{ymin}/,d).replace(/{xmax}/,e).replace(/{ymax}/,b)}this._messageHandler("connect to wfs server...");
v({url:this._getFeatureUrl,handleAs:"text",headers:{"Content-Type":"text/xml"},postData:a,timeout:1E4},{usePost:!0}).then(this._parseGml,this._messageHandler)}},getWFSParameters:function(){return{url:this._url,version:this._version,nsLayerName:this._nsLayerName,wkid:this._wkid,mode:this._mode,nsGeometryFieldName:this._nsGeometryFieldName,inverseFilter:this._inverseFilter,inverseResponse:this._inverseResponse,maxFeatures:this._maxFeatures,getFeatureUrl:this._getFeatureUrl,getFeatureRequest:this._getFeatureRequest,
showDetails:this._showDetails}},setWFSParameters:function(a){a&&(a.url&&(this._url=a.url),a.version&&(this._version=a.version),a.nsLayerName&&(this._nsLayerName=a.nsLayerName),a.wkid&&(this._wkid=parseInt(a.wkid,10)),a.mode&&(this._mode=a.mode),void 0!==a.inverseFilter&&(this._inverseFilter=a.inverseFilter?!0:!1),void 0!==a.inverseResponse&&(this._inverseResponse=a.inverseResponse?!0:!1),a.maxFeatures&&(this._maxFeatures=parseInt(a.maxFeatures,10)),a.getFeatureRequest&&(this._getFeatureRequest=a.getFeatureRequest),
a.getFeatureUrl&&(this._getFeatureUrl=a.getFeatureUrl),a.nsGeometryFieldName&&(this._nsGeometryFieldName=a.nsGeometryFieldName),a.showDetails&&(this._showDetails=a.showDetails))},setPointSymbol:function(a){this._pointSymbol=a},setLineSymbol:function(a){this._lineSymbol=a},setPolygonSymbol:function(a){this._polygonSymbol=a},_setMap:function(a){this._map=a;var d=this.inherited(arguments);this._map&&this._layerEventHandlers.push(this._map.on("extent-change",n.hitch(this,"refresh")));this.getFeature();
this.refresh();return d},_getCapabilitiesResponse:function(a){var d,e,b;this._messageHandler("done.");this._messageHandler("response parsing...");e=(new DOMParser).parseFromString(a,"text/xml");this._version=e.documentElement.attributes.getNamedItem("version").value;var c="2.0.0"===this._version?"http://www.opengis.net/wfs/2.0":"http://www.opengis.net/wfs";if("2.0.0"===this._version){d=e.getElementsByTagNameNS("http://www.opengis.net/ows/1.1","Operation");for(a=0;a<d.length;a++)if((b=d[a].attributes.getNamedItem("name"))&&
"GetFeature"===b.value)b=d[a].getElementsByTagNameNS("http://www.opengis.net/ows/1.1","Post"),this._getFeatureUrl=b[0].attributes.getNamedItem("xlink:href").value}else if("1.1.0"===this._version){d=e.getElementsByTagNameNS("http://www.opengis.net/ows","Operation");for(a=0;a<d.length;a++)if((b=d[a].attributes.getNamedItem("name"))&&"GetFeature"===b.value)b=d[a].getElementsByTagNameNS("http://www.opengis.net/ows","Post"),this._getFeatureUrl=b[0].attributes.getNamedItem("xlink:href").value}else"1.0.0"===
this._version&&(b=e.getElementsByTagNameNS(c,"GetFeature")[0].getElementsByTagNameNS(c,"Post"),this._getFeatureUrl=b[0].attributes.getNamedItem("onlineResource").value);d=[];b=e.getElementsByTagNameNS(c,"FeatureTypeList");for(a=0;a<b.length;a++){var f=b[a].getElementsByTagNameNS(c,"FeatureType");for(e=0;e<f.length;e++){var g=f[e],h=g.getElementsByTagNameNS(c,"Name"),k=h[0].textContent,l=k.indexOf(":"),m=k.substring(0,l),k=k.substring(l+1),h=h[0].lookupNamespaceURI(m),m=g.getElementsByTagNameNS(c,
"Title"),m=0<m.length?m[0].textContent:"",g=this._readDefaultSR(this._version,g),k=h+"|"+k;d.push({name:k,title:m,wkid:g,selected:k===this._nsLayerName?!0:!1})}}""===this._nsLayerName&&0<d.length&&(this._nsLayerName=d[0].name);this.buildRequest();this._messageHandler("done.");if(a=this._getCapabilitiesCallback)delete this._loadCallback,a(d);this.getFeature()},_readDefaultSR:function(a,d){var e="";"2.0.0"===a?e=d.getElementsByTagNameNS("*","DefaultCRS")[0].textContent:"1.1.0"===a?e=d.getElementsByTagNameNS("*",
"DefaultSRS")[0].textContent:"1.0.0"===a&&(e=d.getElementsByTagNameNS("*","SRS")[0].textContent);return(e=e.match(/\d+/g))&&0<e.length?(e=parseInt(e[e.length-1],10),84===e&&(e=4326),parseInt(e,10)):-1},_messageHandler:function(a){},_unsetMap:function(){for(var a=0;a<this._layerEventHandlers.length;a++)A.disconnect(this._layerEventHandlers[a]);this.refresh();this.inherited(arguments)},refresh:function(a){this.clear();this.redraw();"ondemand"===this._mode.toLowerCase()&&this._fireUpdateStart()},redraw:function(){if(this.visible){this._showDetails&&
this._drawExtent();for(var a=0;a<this._graphicArray.length;a++){var d=this._graphicArray[a],e=d.geometry,b=null;"point"===e.type?b=this.renderer?this.renderer.getSymbol(null):this._pointSymbol:"multipoint"===e.type?b=this.renderer?this.renderer.getSymbol(null):this._pointSymbol:"polyline"===e.type?b=this.renderer?this.renderer.getSymbol(null):this._lineSymbol:"polygon"===e.type&&(b=this.renderer?this.renderer.getSymbol(null):this._polygonSymbol);d.setSymbol(b);this.add(d)}}},onUpdateStart:function(){this.getFeature()},
onUpdateEnd:function(){this.clear();this.redraw()},_parseGml:function(a){this._messageHandler("done.");if(this._map){this._messageHandler("response parsing...");a=(new DOMParser).parseFromString(a,"text/xml");this._gmlNS="2.0.0"===this._version?"http://www.opengis.net/gml/3.2":"http://www.opengis.net/gml";""===this._wkid&&(this._wkid=this._map.spatialReference.latestWkid);var d=this._nsLayerName.indexOf("|"),e=this._nsLayerName.substring(0,d),d=this._nsLayerName.substring(d+1);this._graphicArray=
this._readFeatureMembers(a,this._wkid,2,e,d);this.fullExtent=this._createFullExtent(this._graphicArray);this._messageHandler("done.");this._messageHandler("got "+this._graphicArray.length+" features (close, but not same as 'maxFeatures').");this.fields=[];if(this._graphicArray[0]){a=Object.keys(this._graphicArray[0].attributes);for(e=0;e<a.length;e++)d={type:"esriFieldTypeString"},d.name=a[e],d.alias=a[e],this.fields.push(d)}"ondemand"===this._mode.toLowerCase()?this._fireUpdateEnd():this.refresh()}},
_createFullExtent:function(a){for(var d=null,e=0;e<a.length;e++){var b=a[e].geometry,c=null;(c="point"===b.geometryType?new D(b.x,b.y,b.x,b.y,b.spatialReference):b.getExtent())&&(d=null===d?c:d.union(c))}return d},_drawExtent:function(){if(this.fullExtent){var a=new z({geometryType:"polygon",spatialReference:this.fullExtent.spatialReference,rings:[[[this.fullExtent.xmin,this.fullExtent.ymin],[this.fullExtent.xmax,this.fullExtent.ymin],[this.fullExtent.xmax,this.fullExtent.ymax],[this.fullExtent.xmin,
this.fullExtent.ymax],[this.fullExtent.xmin,this.fullExtent.ymin]]]}),a=new r(a),d=new t(t.STYLE_SOLID,null,new p([0,127,255,0.1]));a.setSymbol(d);a.attributes={FullExtent:"",xmin:this.fullExtent.xmin,ymin:this.fullExtent.ymin,xmax:this.fullExtent.xmax,ymax:this.fullExtent.ymax};this.add(a)}},_readFeatureMembers:function(a,d,e,b,c){var f,g,h,k;g=this._readWkidFromNode(a);-1!=g&&(d=g);g=this._readSrsDimension(a);0!==g&&(e=g);var l=[];h=a.getElementsByTagNameNS("*","featureMembers");for(g=0;g<h.length;g++){f=
h[g];k=f.getElementsByTagNameNS(b,c);0===k.length&&(k=f.getElementsByTagNameNS(null,c));0===k.length&&(k=f.getElementsByTagNameNS("*",c));for(f=0;f<k.length;f++)this._readLayer(l,k[f],d,e)}h=a.getElementsByTagNameNS("*","featureMember");for(g=0;g<h.length;g++){f=h[g];k=f.getElementsByTagNameNS(b,c);0===k.length&&(k=f.getElementsByTagNameNS(null,c));0===k.length&&(k=f.getElementsByTagNameNS("*",c));for(f=0;f<k.length;f++)this._readLayer(l,k[f],d,e)}h=a.getElementsByTagNameNS("*","member");for(g=0;g<
h.length;g++){f=h[g];k=f.getElementsByTagNameNS(b,c);0===k.length&&(k=f.getElementsByTagNameNS(null,c));0===k.length&&(k=f.getElementsByTagNameNS("*",c));for(f=0;f<k.length;f++)this._readLayer(l,k[f],d,e)}return l},_readLayer:function(a,d,e,b){var c,f;c=this._readSrsDimension(d);0!==c&&(b=c);var g=d.childNodes,h="",k=null;for(d=0;d<g.length;d++)if(c=g[d],1==c.nodeType&&(f=c.localName,"boundedBy"!==f)){var l=this._readGeometry(c,e,b);if(null!==l){k=l;h=f;this._nsGeometryFieldName=c.namespaceURI+"|"+
c.localName;break}}if(k){e={};for(d=0;d<g.length;d++)c=g[d],f=c.localName,f!==h&&(e[f]=c.textContent.trim());this._convertWFSGeometryToGraphicObjects(a,k,e)}else this._messageHandler("_readLayer(): warnining - no geometry found.")},_convertWFSGeometryToGraphicObjects:function(a,d,e){var b;if("point"===d.geometryType)b=new r,d=new y(d),b.setGeometry(d),b.setAttributes(e),a.push(b);else if("multipoint"===d.geometryType)b=new r,d=new E(d),b.setGeometry(d),b.setAttributes(e),a.push(b);else if("polyline"===
d.geometryType)b=new r,d=new F(d),b.setGeometry(d),b.setAttributes(e),a.push(b);else if("polygon"===d.geometryType)b=new r,d=new z(d),b.setGeometry(d),b.setAttributes(e),a.push(b);else if("multigeometry"===d.geometryType)for(b=0;b<d.length;b++)this._convertWFSGeometryToGraphicObjects(a,d[b],e)},_readGeometry:function(a,d,e){var b,c;b=this._readWkidFromNode(a);-1!=b&&(d=b);b=this._readSrsDimension(a);0!==b&&(e=b);c=a.getElementsByTagNameNS(this._gmlNS,"MultiSurface");if(1<=c.length)for(b=0;b<c.length;)return this._readMultiSurface(c[b],
d,e);c=a.getElementsByTagNameNS(this._gmlNS,"MultiCurve");if(1<=c.length){var f=[];for(b=0;b<c.length;b++){var g=this._readMultiCurve(c[b],d,e);for(a=0;a<g.length;a++)f.push(g[a])}return{geometryType:"polyline",paths:f,spatialReference:{wkid:this._map.spatialReference.latestWkid}}}c=a.getElementsByTagNameNS(this._gmlNS,"MultiGeometry");for(b=0;b<c.length;)return this._readMultiGeometry(c[b],d,e);c=a.getElementsByTagNameNS(this._gmlNS,"Geometry");for(b=0;b<c.length;)return this._readGeometry(c[b],
d,e);c=a.getElementsByTagNameNS(this._gmlNS,"GeometryCollection");for(b=0;b<c.length;)return this._readGeometryCollection(c[b],d,e);c=a.getElementsByTagNameNS(this._gmlNS,"Surface");for(b=0;b<c.length;)return this._readSurface(c[b],d,e);c=a.getElementsByTagNameNS(this._gmlNS,"Curve");for(b=0;b<c.length;)return this._readCurve(c[b],d,e);c=a.getElementsByTagNameNS(this._gmlNS,"MultiPolygon");for(b=0;b<c.length;)return this._readMultiPolygon(c[b],d,e);c=a.getElementsByTagNameNS(this._gmlNS,"Polygon");
for(b=0;b<c.length;)return this._readPolygon(c[b],d,e);c=a.getElementsByTagNameNS(this._gmlNS,"MultiLineString");for(b=0;b<c.length;)return this._readMultiLineString(c[b],d,e);c=a.getElementsByTagNameNS(this._gmlNS,"LineString");for(b=0;b<c.length;){d=this._readLineString(c[b],d,e);e={geometryType:"polyline",paths:[],spatialReference:{wkid:this._map.spatialReference.latestWkid}};b=[];for(a=0;a<d.length;a++)b.push(d[a]);e.paths.push(b);return e}c=a.getElementsByTagNameNS(this._gmlNS,"LinearRing");
for(b=0;b<c.length;)return this._readLinearRing(c[b],d,e);c=a.getElementsByTagNameNS(this._gmlNS,"Box");if(1<=c.length)for(b=0;b<c.length;)return this._readBox(c[b],d,e);c=a.getElementsByTagNameNS(this._gmlNS,"Envelope");for(b=0;b<c.length;)return this._readEnvelope(c[b],d,e);c=a.getElementsByTagNameNS(this._gmlNS,"MultiPoint");if(1<=c.length)for(b=0;b<c.length;)return this._readMultiPoint(c[b],d,e);c=a.getElementsByTagNameNS(this._gmlNS,"Point");for(b=0;b<c.length;)return this._readPoint(c[b],d,
e);return null},_readGeometryCollection:function(a,d,e){var b,c=this._readWkidFromNode(a);-1!=c&&(d=c);c=this._readSrsDimension(a);0!==c&&(e=c);c=[];c.geometryType="multigeometry";c.spatialReference={wkid:this._map.spatialReference.latestWkid};b=a.getElementsByTagNameNS(this._gmlNS,"geometryMember");for(a=0;a<b.length;a++){var f=this._readGeometryMember(b[a],d,e);c.push(f)}return c},_readMultiGeometry:function(a,d,e){var b,c=this._readWkidFromNode(a);-1!=c&&(d=c);c=this._readSrsDimension(a);0!==c&&
(e=c);c=[];c.geometryType="multigeometry";c.spatialReference={wkid:this._map.spatialReference.latestWkid};b=a.getElementsByTagNameNS(this._gmlNS,"geometryMember");for(a=0;a<b.length;a++){var f=this._readGeometryMember(b[a],d,e);c.push(f)}return c},_readSurface:function(a,d,e){var b,c;b=this._readWkidFromNode(a);-1!=b&&(d=b);b=this._readSrsDimension(a);0!==b&&(e=b);var f=[];f.geometryType="multigeometry";f.spatialReference={wkid:this._map.spatialReference.latestWkid};c=a.getElementsByTagNameNS(this._gmlNS,
"Point");for(b=0;b<c.length;b++)f.push(this._readPoint(c[b],d,e));c=a.getElementsByTagNameNS(this._gmlNS,"patches");for(b=0;b<c.length;b++){a=this._readPatches(c[b],d,e);for(var g=0;g<a.length;g++)f.push(a[g])}return f},_readMultiSurface:function(a,d,e){var b,c,f;b=this._readWkidFromNode(a);-1!=b&&(d=b);b=this._readSrsDimension(a);0!==b&&(e=b);var g=[];g.geometryType="multigeometry";g.spatialReference={wkid:this._map.spatialReference.latestWkid};f=a.getElementsByTagNameNS(this._gmlNS,"surfaceMember");
for(b=0;b<f.length;b++){var h=this._readSurfaceMember(f[b],d,e);for(c=0;c<h.length;c++)g.push(h[c])}f=a.getElementsByTagNameNS(this._gmlNS,"surfaceMembers");for(b=0;b<f.length;b++){a=this._readSurfaceMembers(f[b],d,e);for(c=0;c<a.length;c++)g.push(a[c])}return g},_readCurve:function(a,d,e){var b,c=this._readWkidFromNode(a);-1!=c&&(d=c);c=this._readSrsDimension(a);0!==c&&(e=c);c={geometryType:"polyline",paths:[],spatialReference:{wkid:this._map.spatialReference.latestWkid}};b=a.getElementsByTagNameNS(this._gmlNS,
"segments");for(a=0;a<b.length;a++)for(var f=this._readSegments(b[a],d,e),g=0;g<f.length;g++)c.paths.push(f[g]);return c},_readSegments:function(a,d,e){var b,c=this._readWkidFromNode(a);-1!=c&&(d=c);c=this._readSrsDimension(a);0!==c&&(e=c);c=[];c.geometryType="multigeometry";c.spatialReference={wkid:this._map.spatialReference.latestWkid};b=a.getElementsByTagNameNS(this._gmlNS,"LineStringSegment");for(a=0;a<b.length;a++){var f=this._readLineStringSegment(b[a],d,e);c.push(f)}return c},_readLineStringSegment:function(a,
d,e){var b=this._readWkidFromNode(a);-1!=b&&(d=b);b=this._readSrsDimension(a);0!==b&&(e=b);for(a=a.getElementsByTagNameNS(this._gmlNS,"posList");0<a.length;)return this._readPosList(a[0],d,e)},_readMultiCurve:function(a,d,e){var b,c,f,g;b=this._readWkidFromNode(a);-1!=b&&(d=b);b=this._readSrsDimension(a);0!==b&&(e=b);var h=[];h.spatialReference={wkid:this._map.spatialReference.latestWkid};f=a.getElementsByTagNameNS(this._gmlNS,"curveMember");for(b=0;b<f.length;b++){g=this._readCurveMember(f[b],d,
e);for(c=0;c<g.length;c++)h.push(g[c])}f=a.getElementsByTagNameNS(this._gmlNS,"curveMembers");for(b=0;b<f.length;b++){g=this._readCurveMembers(f[b],d,e);for(c=0;c<g.length;c++)h.push(g[c])}return h},_readGeometryMember:function(a,d,e){var b,c;b=this._readWkidFromNode(a);-1!=b&&(d=b);b=this._readSrsDimension(a);0!==b&&(e=b);c=a.getElementsByTagNameNS(this._gmlNS,"Point");for(b=0;b<c.length;)return this._readPoint(c[b],d,e);c=a.getElementsByTagNameNS(this._gmlNS,"LineString");for(b=0;b<c.length;){d=
this._readLineString(c[b],d,e);e={geometryType:"polyline",paths:[],spatialReference:{wkid:this._map.spatialReference.latestWkid}};b=[];for(a=0;a<d.length;a++)b.push(d[a]);e.paths.push(b);return e}c=a.getElementsByTagNameNS(this._gmlNS,"Polygon");for(b=0;b<c.length;)return this._readPolygon(c[b],d,e);return null},_readSurfaceMember:function(a,d,e){var b,c=this._readWkidFromNode(a);-1!=c&&(d=c);c=this._readSrsDimension(a);0!==c&&(e=c);c=[];c.geometryType="multigeometry";c.spatialReference={wkid:this._map.spatialReference.latestWkid};
b=a.getElementsByTagNameNS(this._gmlNS,"Polygon");for(a=0;a<b.length;a++){var f=this._readPolygon(b[a],d,e);c.push(f)}return c},_readSurfaceMembers:function(a,d,e){var b,c=this._readWkidFromNode(a);-1!=c&&(d=c);c=this._readSrsDimension(a);0!==c&&(e=c);c=[];c.geometryType="multigeometry";c.spatialReference={wkid:this._map.spatialReference.latestWkid};b=a.getElementsByTagNameNS(this._gmlNS,"Polygon");for(a=0;a<b.length;a++){var f=this._readPolygon(b[a],d,e);c.push(f)}return c},_readCurveMember:function(a,
d,e){var b,c=this._readWkidFromNode(a);-1!=c&&(d=c);c=this._readSrsDimension(a);0!==c&&(e=c);c=[];c.geometryType="multigeometry";c.spatialReference={wkid:this._map.spatialReference.latestWkid};b=a.getElementsByTagNameNS(this._gmlNS,"LineString");for(a=0;a<b.length;a++){var f=this._readLineString(b[a],d,e);c.push(f)}return c},_readCurveMembers:function(a,d,e){var b,c=this._readWkidFromNode(a);-1!=c&&(d=c);c=this._readSrsDimension(a);0!==c&&(e=c);c=[];c.geometryType="multigeometry";c.spatialReference=
{wkid:this._map.spatialReference.latestWkid};b=a.getElementsByTagNameNS(this._gmlNS,"LineString");for(a=0;a<b.length;a++){var f=this._readLineString(b[a],d,e);c.push(f)}return c},_readBox:function(a,d,e){var b,c,f,g,h,k,l,m=this._readWkidFromNode(a);-1!=m&&(d=m);m=this._readSrsDimension(a);0!==m&&(e=m);m={geometryType:"polygon",rings:[],spatialReference:{wkid:this._map.spatialReference.latestWkid}};c=a.getElementsByTagNameNS(this._gmlNS,"coordinates");for(b=0;b<c.length;b++)if(f=this._readCoordinates(c[b],
d,e))return 1<=f.length&&(g=k=f[0][0],h=l=f[0][1]),1<=f.length&&(k=f[1][0],l=f[1][1]),m.rings.push([[g,h],[g,l],[k,l],[k,h],[g,h]]),m;c=a.getElementsByTagNameNS(this._gmlNS,"coord");if(2<=c.length){if((a=this._readCoord(c[0],d,e))&&1<=a.length)g=k=a[0][0],h=l=a[0][1];if((d=this._readCoord(c[1],d,e))&&1<=d.length)k=d[0][0],l=d[0][1];m.rings.push([[g,h],[g,l],[k,l],[k,h],[g,h]]);return m}return null},_readEnvelope:function(a,d,e){var b,c,f,g;b=this._readWkidFromNode(a);-1!=b&&(d=b);b=this._readSrsDimension(a);
0!==b&&(e=b);c=a.getElementsByTagNameNS(this._gmlNS,"lowerCorner");for(b=0;b<c.length;b++){var h=this._readCoordinates(c[b],d,e);h&&(f=h[0])}c=a.getElementsByTagNameNS(this._gmlNS,"upperCorner");for(b=0;b<c.length;b++)(a=this._readCoordinates(c[b],d,e))&&(g=a[0]);return f&&g?{geometryType:"polygon",rings:[[[f[0],f[1]],[f[0],g[1]],[g[0],g[1]],[g[0],f[1]],[f[0],f[1]]]],spatialReference:{wkid:this._map.spatialReference.latestWkid}}:null},_readPolygon:function(a,d,e){var b,c,f;b=this._readWkidFromNode(a);
-1!=b&&(d=b);b=this._readSrsDimension(a);0!==b&&(e=b);var g={geometryType:"polygon",rings:[],spatialReference:{wkid:this._map.spatialReference.latestWkid}};c=a.getElementsByTagNameNS(this._gmlNS,"outerBoundaryIs");for(b=0;b<c.length;b++)f=this._readOuterBoundaryIs(c[b],d,e),g.rings.push(f);c=a.getElementsByTagNameNS(this._gmlNS,"innerBoundaryIs");for(b=0;b<c.length;b++)f=this._readInnerBoundaryIs(c[b],d,e),g.rings.push(f);c=a.getElementsByTagNameNS(this._gmlNS,"exterior");for(b=0;b<c.length;b++)f=
this._readExterior(c[b],d,e),g.rings.push(f);c=a.getElementsByTagNameNS(this._gmlNS,"interior");for(b=0;b<c.length;b++)f=this._readInterior(c[b],d,e),g.rings.push(f);return g},_readPolygonMember:function(a,d,e){var b=this._readWkidFromNode(a);-1!=b&&(d=b);b=this._readSrsDimension(a);0!==b&&(e=b);for(a=a.getElementsByTagNameNS(this._gmlNS,"Polygon");0<a.length;)return this._readPolygon(a[0],d,e);return null},_readMultiPolygon:function(a,d,e){var b,c=this._readWkidFromNode(a);-1!=c&&(d=c);c=this._readSrsDimension(a);
0!==c&&(e=c);c=[];c.geometryType="multigeometry";c.spatialReference={wkid:this._map.spatialReference.latestWkid};b=a.getElementsByTagNameNS(this._gmlNS,"polygonMember");for(a=0;a<b.length;a++){var f=this._readPolygonMember(b[a],d,e);c.push(f)}return c},_readOuterBoundaryIs:function(a,d,e){var b=this._readWkidFromNode(a);-1!=b&&(d=b);b=this._readSrsDimension(a);0!==b&&(e=b);for(a=a.getElementsByTagNameNS(this._gmlNS,"LinearRing");0<a.length;)return this._readLinearRing(a[0],d,e);return null},_readInnerBoundaryIs:function(a,
d,e){var b=this._readWkidFromNode(a);-1!=b&&(d=b);b=this._readSrsDimension(a);0!==b&&(e=b);for(a=a.getElementsByTagNameNS(this._gmlNS,"LinearRing");0<a.length;)return this._readLinearRing(a[0],d,e);return null},_readExterior:function(a,d,e){var b=this._readWkidFromNode(a);-1!=b&&(d=b);b=this._readSrsDimension(a);0!==b&&(e=b);for(a=a.getElementsByTagNameNS(this._gmlNS,"LinearRing");0<a.length;)return this._readLinearRing(a[0],d,e);return null},_readInterior:function(a,d,e){var b=this._readWkidFromNode(a);
-1!=b&&(d=b);b=this._readSrsDimension(a);0!==b&&(e=b);for(a=a.getElementsByTagNameNS(this._gmlNS,"LinearRing");0<a.length;)return this._readLinearRing(a[0],d,e);return null},_readPatches:function(a,d,e){var b,c=this._readWkidFromNode(a);-1!=c&&(d=c);c=this._readSrsDimension(a);0!==c&&(e=c);c=[];c.spatialReference={wkid:this._map.spatialReference.latestWkid};b=a.getElementsByTagNameNS(this._gmlNS,"PolygonPatch");for(a=0;a<b.length;a++)c.push(this._readPolygon(b[a],d,e));return c},_readLineString:function(a,
d,e){var b,c,f,g,h;b=this._readWkidFromNode(a);-1!=b&&(d=b);b=this._readSrsDimension(a);0!==b&&(e=b);var k=[];k.spatialReference={wkid:this._map.spatialReference.latestWkid};f=a.getElementsByTagNameNS(this._gmlNS,"coordinates");for(b=0;b<f.length;b++)if(g=this._readCoordinates(f[b],d,e))for(c=0;c<g.length;c++)h=g[c],k.push(h);f=a.getElementsByTagNameNS(this._gmlNS,"coord");for(b=0;b<f.length;b++)if(g=this._readCoord(f[b],d,e))for(c=0;c<g.length;c++)h=g[c],k.push(h);f=a.getElementsByTagNameNS(this._gmlNS,
"posList");for(b=0;b<f.length;b++)if(g=this._readPosList(f[b],d,e))for(c=0;c<g.length;c++)h=g[c],k.push(h);return k},_readLineStringMember:function(a,d,e){var b=this._readWkidFromNode(a);-1!=b&&(d=b);b=this._readSrsDimension(a);0!==b&&(e=b);for(a=a.getElementsByTagNameNS(this._gmlNS,"LineString");0<a.length;)return this._readLineString(a[0],d,e);return null},_readMultiLineString:function(a,d,e){var b,c=this._readWkidFromNode(a);-1!=c&&(d=c);c=this._readSrsDimension(a);0!==c&&(e=c);c={geometryType:"polyline",
paths:[],spatialReference:{wkid:this._map.spatialReference.latestWkid}};b=a.getElementsByTagNameNS(this._gmlNS,"lineStringMember");for(a=0;a<b.length;a++){var f=this._readLineStringMember(b[a],d,e);f&&c.paths.push(f)}return 1<=c.paths.length?c:null},_readPoint:function(a,d,e){var b,c,f;b=this._readWkidFromNode(a);-1!=b&&(d=b);b=this._readSrsDimension(a);0!==b&&(e=b);c=a.getElementsByTagNameNS(this._gmlNS,"coordinates");for(b=0;b<c.length;b++)if(f=this._readCoordinates(c[b],d,e))return{geometryType:"point",
x:f[0][0],y:f[0][1],spatialReference:{wkid:this._map.spatialReference.latestWkid}};c=a.getElementsByTagNameNS(this._gmlNS,"pos");for(b=0;b<c.length;b++)if((f=this._readPos(c[b],d,e))&&0<f.length)return{geometryType:"point",x:f[0][0],y:f[0][1],spatialReference:{wkid:this._map.spatialReference.latestWkid}};c=a.getElementsByTagNameNS(this._gmlNS,"coord");for(b=0;b<c.length;b++)if(a=this._readCoord(c[b],d,e))return{geometryType:"point",x:a[0][0],y:a[0][1],spatialReference:{wkid:this._map.spatialReference.latestWkid}};
return null},_readPointMember:function(a,d,e){var b=this._readWkidFromNode(a);-1!=b&&(d=b);b=this._readSrsDimension(a);0!==b&&(e=b);for(a=a.getElementsByTagNameNS(this._gmlNS,"Point");0<a.length;)return this._readPoint(a[0],d,e);return null},_readMultiPoint:function(a,d,e){var b,c=this._readWkidFromNode(a);-1!=c&&(d=c);c=this._readSrsDimension(a);0!==c&&(e=c);c={geometryType:"multipoint",points:[],spatialReference:{wkid:this._map.spatialReference.latestWkid}};b=a.getElementsByTagNameNS(this._gmlNS,
"pointMember");for(a=0;a<b.length;a++){var f=this._readPointMember(b[a],d,e);f&&c.points.push([f.x,f.y])}return 1<=c.points.length?c:null},_readLinearRing:function(a,d,e){var b,c;b=this._readWkidFromNode(a);-1!=b&&(d=b);b=this._readSrsDimension(a);0!==b&&(e=b);c=a.getElementsByTagNameNS(this._gmlNS,"coordinates");for(b=0;b<c.length;)return this._readCoordinates(c[b],d,e);c=a.getElementsByTagNameNS(this._gmlNS,"posList");for(b=0;b<c.length;)return this._readCoordinates(c[b],d,e);c=a.getElementsByTagNameNS(this._gmlNS,
"pos");for(b=0;b<c.length;)return this._readPos(c[b],d,e)},_readCoordinatesBody:function(a,d,e){var b,c=new u(a);d=d.trim();var f,g,h=[];h.spatialReference={wkid:this._map.spatialReference.latestWkid};a=this._isReverse(a,this.version);if(d)if(2===e){if((d=d.match(/[0123456789.\-\+eE]+/g))&&2<=d.length)for(e=0;e<d.length;e+=2)f=parseFloat(d[e]),g=parseFloat(d[e+1]),a&&(b=g,g=f,f=b),b={},this._projectFromSRToSR(c,this._map.spatialReference,f,g,b)&&(f=b.x,g=b.y),h.push([f,g])}else if(3===e&&(d=d.match(/[0123456789.\-\+eE]+/g))&&
3<=d.length)for(e=0;e<d.length;e+=3)f=parseFloat(d[e]),g=parseFloat(d[e+1]),a&&(b=g,g=f,f=b),b={},this._projectFromSRToSR(c,this._map.spatialReference,f,g,b)&&(f=b.x,g=b.y),h.push([f,g]);return h},_readCoord:function(a,d,e){var b,c,f,g,h=this._readWkidFromNode(a);-1!=h&&(d=h);h=new u(d);f=this._readSrsDimension(a);0!==f&&(e=f);var k=this._isReverse(d,this.version),l=[];l.spatialReference={wkid:this._map.spatialReference.latestWkid};f=0;c=a.getElementsByTagNameNS(this._gmlNS,"X");for(b=0;b<c.length;){f=
this._readFloat(c[b],d,e);break}g=0;c=a.getElementsByTagNameNS(this._gmlNS,"Y");for(b=0;b<c.length;){g=this._readFloat(c[b],d,e);break}k&&(a=g,g=f,f=a);a={};this._projectFromSRToSR(h,this._map.spatialReference,f,g,a)&&(f=a.x,g=a.y);l.push(k?[g,f]:[f,g]);return l},_readCoordinates:function(a,d,e){var b=this._readWkidFromNode(a);-1!=b&&(d=b);b=this._readSrsDimension(a);0!==b&&(e=b);return this._readCoordinatesBody(d,a.textContent,e)},_readPos:function(a,d,e){var b=this._readWkidFromNode(a);-1!=b&&(d=
b);b=this._readSrsDimension(a);0!==b&&(e=b);return this._readCoordinatesBody(d,a.textContent,e)},_readPosList:function(a,d,e){var b=this._readWkidFromNode(a);-1!=b&&(d=b);b=this._readSrsDimension(a);0!==b&&(e=b);return this._readCoordinatesBody(d,a.textContent,e)},_projectFromSRToSR:function(a,d,e,b,c){if(x.canProject(a,d))return a=new y(e,b,a),d=x.project(a,d),c.x=d.x,c.y=d.y,!0;c.x=e;c.y=b;return!1},_readFloat:function(a){return(a=a.textContent)?parseFloat(a):0},_readSrsDimension:function(a){return a.attributes&&
(a=a.attributes.getNamedItem("srsDimension"))?parseInt(a.value,10):0},_readWkidFromNode:function(a){if(a.attributes&&(a=a.attributes.getNamedItem("srsName")))if((a=a.value.match(/\d+/g))&&0<a.length)return a=parseInt(a[a.length-1],10),84===a&&(a=4326),parseInt(a,10);return-1},_isReverse:function(a,d){return this._inverseResponse}});B("extend-esri")&&n.setObject("layers.WFSLayer",s,C);return s});