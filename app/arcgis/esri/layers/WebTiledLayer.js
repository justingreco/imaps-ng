//>>built
define("esri/layers/WebTiledLayer","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/url dojo/sniff dojo/string ../config ../kernel ../request ../urlUtils ../SpatialReference ../geometry/Extent ./TiledMapServiceLayer ./TileInfo".split(" "),function(b,l,f,s,m,n,t,u,v,p,g,q,w,x){b=b(w,{declaredClass:"esri.layers.WebTiledLayer",constructor:function(h,a){a||(a={});this.urlTemplate=h;var d=new q(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new g({wkid:102100})),
c=new q(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new g({wkid:102100}));this.initialExtent=a.initialExtent||d;this.fullExtent=a.fullExtent||c;this.tileInfo=a.tileInfo?a.tileInfo:new x({dpi:96,rows:256,cols:256,origin:{x:-2.0037508342787E7,y:2.0037508342787E7},spatialReference:{wkid:102100},lods:[{level:0,resolution:156543.033928,scale:5.91657527591555E8},{level:1,resolution:78271.5169639999,scale:2.95828763795777E8},{level:2,resolution:39135.7584820001,scale:1.47914381897889E8},
{level:3,resolution:19567.8792409999,scale:7.3957190948944E7},{level:4,resolution:9783.93962049996,scale:3.6978595474472E7},{level:5,resolution:4891.96981024998,scale:1.8489297737236E7},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},{level:10,resolution:152.874056570411,scale:577790.554289},{level:11,resolution:76.4370282850732,
scale:288895.277144},{level:12,resolution:38.2185141425366,scale:144447.638572},{level:13,resolution:19.1092570712683,scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:0.597164283559817,scale:2256.994353},{level:19,resolution:0.298582141647617,scale:1128.497176}]});this.spatialReference=
new g(this.tileInfo.spatialReference.toJson());this.copyright=a.copyright||"";var e=new s(h),d=e.scheme+"://"+e.authority+"/";this.urlPath=h.substring(d.length);this.tileServers=a.tileServers||[];-1===e.authority.indexOf("{subDomain}")&&this.tileServers.push(d);if(a.subDomains&&0<a.subDomains.length&&1<e.authority.split(".").length){this.subDomains=a.subDomains;var b;f.forEach(a.subDomains,function(a){-1<e.authority.indexOf("${subDomain}")?b=e.scheme+"://"+n.substitute(e.authority,{subDomain:a})+
"/":-1<e.authority.indexOf("{subDomain}")&&(b=e.scheme+"://"+e.authority.replace(/\{subDomain\}/gi,a)+"/");this.tileServers.push(b)},this)}this.tileServers=f.map(this.tileServers,function(a){"/"!==a.charAt(a.length-1)&&(a+="/");return a});this._levelToLevelValue=[];f.forEach(this.tileInfo.lods,function(a){this._levelToLevelValue[a.level]=a.levelValue||a.level},this);var k=l.hitch(this,function(){this.loaded=!0;this.onLoad(this)});if(m("chrome")){var d=this.getTileUrl(0,0,0),c=t.defaults.io,r="with-credentials"===
c.useCors?p.canUseXhr(d,!0):-1;(c=-1<r?c.corsEnabledServers[r]:null)&&c.withCredentials?v({url:d,handleAs:"arraybuffer"}).addBoth(function(a){k()}):k()}else k()},getTileUrl:function(b,a,d){b=this._levelToLevelValue[b];var c=this.tileServers[a%this.tileServers.length]+n.substitute(this.urlPath,{level:b,col:d,row:a}),c=c.replace(/\{level\}/gi,b).replace(/\{row\}/gi,a).replace(/\{col\}/gi,d),c=this.addTimestampToURL(c);return p.addProxy(c)}});m("extend-esri")&&l.setObject("layers.WebTiledLayer",b,u);
return b});